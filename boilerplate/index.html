<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible"
        content="IE=Edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1">
  <meta name="widget-config"
        data-type="popup"
        data-width="100%"
        data-height="100%"
        data-z-index="999999"
        data-autoshow="true">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css">
  <link rel="stylesheet"
        href="styles.css">
</head>

<body>
  <section class="widget">
    <section class="login"
             data-fl-screen="1">
      <a class="close"
         data-fl-close
         data-fl-track="close-screen-1">&times;</a>

      <form class="form">
        <div>
          <label for="name">Name</label>
          <input type="text"
                 id="name"
                 name="user_name"
                 required>
        </div>
        <div>
          <label for="mail">E-mail</label>
          <input type="email"
                 id="mail"
                 name="user_mail"
                 required
                 pattern="([\+\w-]+(?:\.[\+\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)">
        </div>
        <div>
          <label for="tel">Phone</label>
          <input type="tel"
                 id="tel"
                 name="user_phone"
                 required
                 pattern="(\+7|7|8)[ ]?\(?(\d{3})\)?[ -]?(\d{3}[ -]?\d{2}[ -]?\d{2})">
        </div>
        <div>
          <label for="checkbox">Agree with</label>
          <a class="js-to-terms"
             data-fl-track="click-button-to-terms">conditions</a>:
          <input type="checkbox"
                 id="checkbox"
                 name="checkbox"
                 required>
        </div>

        <button class="form__button"
                type="submit"
                data-fl-track="click-button">Submit</button>
      </form>
    </section>

    <section class="terms"
             data-fl-screen="terms">
      <a class="close"
         data-fl-close
         data-fl-track="close-screen-terms">&times;</a>

      <h3 class="terms__heading">Terms</h3>
      <p class="terms__text"></p>

      <button class="terms__button js-to-login"
              data-fl-track="click-button-to-login"></button>
    </section>

    <section class="success"
             data-fl-screen="success">
      <a class="close"
         data-fl-close
         data-fl-track="close-screen-success">&times;</a>

      <h3 class="widget__heading">Success</h3>
      <p class="widget__description"></p>
    </section>
  </section>

  <script defer
          src="https://cdnjs.cloudflare.com/ajax/libs/cleave.js/1.3.4/cleave.min.js"></script>
  <script defer
          src="https://cdnjs.cloudflare.com/ajax/libs/cleave.js/1.3.4/addons/cleave-phone.ru.js"></script>

  <script>
    // document.addEventListener("DOMContentLoaded", function() {});

    function qs(s) {
      return document.querySelector(s);
    }

    widget.ready(function () {
      qs(".js-to-terms").addEventListener("click", function () {
        widget.setScreen("terms");
      });
      qs(".js-to-terms").addEventListener("click", function () {
        widget.setScreen("login");
      });

      new Cleave('[name="user_phone"]', {
        phone: true,
        phoneRegionCode: "RU",
        prefix: "+7",
        noImmediatePrefix: true
      });

      var form = document.querySelector(".form");

      form.addEventListener("submit", function (event) {
        var name = form.elements.user_name.value;
        var email = form.elements.user_mail.value;
        var phone = form.elements.user_phone.value;

        widget
          .collectEmail(email, name, {
            phone: phone,
            decision: "true"
          })
          .then(function () {
            widget.setScreen("success");
          });

        event.preventDefault();
      });
    });
  </script>

</body>

</html>